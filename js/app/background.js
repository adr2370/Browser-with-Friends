function _cr_crossrider_ready_to_run_the_user_background_code() {

//------------------  PLUGIN CrossriderUtils START  ------------------
if(typeof(appAPI)==="undefined"){appAPI={}}var CR__bIsIEWindow=false;if(typeof window!=="undefined"&&typeof window.navigator!=="undefined"&&typeof window.navigator.userAgent!=="undefined"){CR__bIsIEWindow=/MSIE (\d+\.\d+);/.test(window.navigator.userAgent)}appAPI.JSON={};if(typeof JSON!=="undefined"&&!CR__bIsIEWindow){appAPI.JSON=JSON}else{(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.to_CR_JSON!=="function"){Date.prototype.to_CR_JSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.to_CR_JSON=Number.prototype.to_CR_JSON=Boolean.prototype.to_CR_JSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.to_CR_JSON==="function"){value=value.to_CR_JSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof appAPI.JSON.stringify!=="function"){appAPI.JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("appAPI.JSON.stringify")}return str("",{"":value})}}if(typeof appAPI.JSON.parse!=="function"){appAPI.JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("appAPI.JSON.parse")}}}())}(function(a){a.debug=function(h,f){if(!a.isDebugMode()){return}var b=!a.debug.settings.console;if(f!=null){b=f}try{if(!b){var g=new Date();var i=(((a.debug.settings.timestamp)&&(typeof(h)=="string"))?(g.toLocaleTimeString()+"."+g.getMilliseconds()+": "+h):h);console.log(i)}else{alert(h)}}catch(c){alert(h)}};a.debug.settings={console:true,timestamp:true}})(appAPI);(function(a){if(typeof a.installer==="undefined"){a.installer={}}a.installer.getParams=function(){return(a.db.get("InstallerParams")||{})};a.installer.getUnixTime=function(){return(a.db.get("InstallationTime")||null)}})(appAPI);(function(b){b.time={};b.time.secondsFromNow=function(c){return a(c*1000)};b.time.secondsAgo=function(c){return a(c*-1000)};b.time.minutesFromNow=function(c){return a(c*60*1000)};b.time.minutesAgo=function(c){return a(c*60*-1000)};b.time.hoursFromNow=function(c){return a(c*3600*1000)};b.time.hoursAgo=function(c){return a(c*3600*-1000)};b.time.daysFromNow=function(c){return a(c*3600*24*1000)};b.time.daysAgo=function(c){return a(c*3600*24*-1000)};b.time.yearsFromNow=function(c){return a(c*365*3600*24*1000)};b.time.yearsAgo=function(c){return a(c*365*3600*24*-1000)};function a(c){return new Date(new Date().getTime()+c)}})(appAPI);(function(a){a.analytics={};a.analytics.trackUrl=function(b){function c(h,j,e){function o(q,i){return q+Math.floor(Math.random()*(i-q))}var l=1000000000,p=o(l,9999999999),f=o(10000000,99999999),g=o(l,2147483647),n=(new Date()).getTime(),m=window.location,k=new Image(),d=document.location.protocol+"//www.google-analytics.com/__utm.gif?utmwv=1.3&utmn="+p+"&utmsr=-&utmsc=-&utmul=-&utmje=0&utmfl=-&utmdt=-&utmhn="+j+"&utmr="+m+"&utmp="+e+"&utmac="+h+"&utmcc=__utma%3D"+f+"."+g+"."+n+"."+n+"."+n+".2%3B%2B__utmb%3D"+f+"%3B%2B__utmc%3D"+f+"%3B%2B__utmz%3D"+f+"."+n+".2.2.utmccn%3D(referral)%7Cutmcsr%3D"+m.host+"%7Cutmcct%3D"+m.pathname+"%7Cutmcmd%3Dreferral%3B%2B__utmv%3D"+f+".-%3B";k.src=d}if((this.settings.account=="")||(this.settings.domain=="")){a.debug("Error: In order to use the analytics API you must first specify your domain and account ID from Google Analytics!\nThis can easily done by setting appAPI.setting.account and appAPI.setting.domain");return}c(this.settings.account,this.settings.domain,b)};a.analytics.trackEvent=function(c,e,b,d){function f(m,o,h,k,n,u,v){function t(x,i){return x+Math.floor(Math.random()*(i-x))}var q=1000000000,w=t(q,9999999999),j=t(10000000,99999999),l=t(q,2147483647),s=(new Date()).getTime(),r=window.location,p=new Image(),g=document.location.protocol+"//www.google-analytics.com/__utm.gif?utmwv=4.8.9&utmn="+w+"&utmsr=-&utmsc=-&utmul=-&utmje=0&utmfl=-&utmdt=-&utmhn="+o+"&utmr=-&utmt=event&utme=5("+k+"*"+n+"*"+u+")("+v+")&utmp="+h+"&utmac="+m+"&utmcc=__utma%3D"+j+"."+l+"."+s+"."+s+"."+s+".2%3B%2B__utmb%3D"+j+"%3B%2B__utmc%3D"+j+"%3B%2B__utmz%3D"+j+"."+s+".2.2.utmccn%3D(referral)%7Cutmcsr%3D"+r.host+"%7Cutmcct%3D"+r.pathname+"%7Cutmcmd%3Dreferral%3B%2B__utmv%3D"+j+".-%3B";p.src=g}if(typeof(c)!="string"){c=""}if(typeof(e)!="string"){e=""}if(typeof(b)!="string"){b=""}if(typeof(d)!="number"){d=0}if((c=="")&&(e=="")&&(b=="")&&(d==0)){a.debug("Error: In order to use trackEvent you must specify the event parameters!");return}if((this.settings.account=="")||(this.settings.domain=="")){a.debug("Error: In order to use the analytics API you must first specify your domain and account ID from Google Analytics!\nThis can easily done by setting appAPI.setting.account and appAPI.setting.domain");return}f(this.settings.account,this.settings.domain,document.location.href,c,e,b,d)};a.analytics.settings={account:"",domain:""}})(appAPI);
//------------------  PLUGIN CrossriderUtils END  --------------------

//------------------  PLUGIN CHAppAPIWrapper START  ------------------
(function(k){function l(m){return(typeof m!="undefined"&&!!m);}function b(m,n){if(l(m)){if(typeof InternalMessaging!="undefined"){if(l(n)&&typeof n==="function"){InternalMessaging.messageToBackground(m,n);}else{InternalMessaging.messageToBackground(m);}}else{if(l(n)&&typeof n==="function"){chrome.extension.sendRequest(m,n);}else{chrome.extension.sendRequest(m);}}}}function g(p,m,o,n){Object.defineProperty(p,m,{get:function(){return k.manifest[o]||n;}});}var i=function(n){var m=n,o=this;this.id=m.appID;this.platformVersion=parseFloat(m.cr_version).toString();this.userId=null;if(typeof(Crossrider)!=="undefined"){this.userId=Crossrider._bic;}else{this.userId=m._bic;}g(this,"description","description");g(this,"name","shortname");g(this,"version","ver");g(this,"environment","modetype","production");return this;};var c=function(o){var n=o,q=this;var p={};if(!p.hasOwnProperty("userCode")&&!p.hasOwnProperty("backgroundCode")){var m=function(r){p=r;};if(typeof(Crossrider)!=="undefined"){Crossrider.getIntrnalDebugUrls(m);}else{b({action:"getIntrnalDebugUrls",passCallback:true},m);}}this.turnOn=function(r){if(typeof(r)==="undefined"||r===null){return false;}if(typeof(r.userCode)!=="string"){return false;}if(typeof(r.backgroundCode)!=="string"){return false;}if(typeof(Crossrider)!=="undefined"){Crossrider.switchInternalDebug(true,r);}else{b({action:"switchInternalDebug",params:[true,r]});}return true;};this.turnOff=function(){if(typeof(Crossrider)!=="undefined"){Crossrider.switchInternalDebug(false);}else{b({action:"switchInternalDebug",params:[false]});}};this.isDebugMode=function(){return(typeof(Crossrider)==="undefined"?n.isDebugMode():Crossrider.debug);};this.getDebugUrl=function(){return p;};return this;};var j=function(n){var m=n,o=this;g(this,"trustedDomain","domain");g(this,"groupId","groupid");g(this,"remoteFbApiUrl","remotefbapiurl");return this;};var h=function(n){var m=n,o=this;this.get=function(s,q){var p=false;if(typeof(q)=="function"){p=true;}if(p){m.request.get(s,function(t){q(t,false);},function(){q(-1,true);});}else{var r=m.request.sync.get(s);if(r!==null){return{file_content:r,err:false};}else{return{file_content:-1,err:true};}}};return this;};function d(n){var m=n,o=this;n.internal.file=new h(m);n.internal.manifest=new j(m);n.internal.debug=new c(m);n.internal.forceUpdate=function(){if(typeof(Crossrider)!=="undefined"){Crossrider._dailyCron(true);}else{b({action:"_dailyCron",params:[true]});}};n.internal.reloadBackground=function(){if(typeof(Crossrider)!=="undefined"){Crossrider.reload();}else{b({action:"reload"});}};}var a=function(m){function n(q){var o=q;if(typeof UserReport!="undefined"){var p=(l(q)&&q.hasOwnProperty("name")&&l(q.name))?q.name:"Request UserCallback";o=UserReport.surroundCallbackWithTryCatch(q,p);}return o;}this.get=function(q,t,s){var p={url:q};var o=n(t);var r=n(s);var u=function(w){var v=function(y,z){if(o&&(typeof o=="function")){o(y,z);}};var x=function(y,z){if(r&&(typeof r=="function")){r(y,z);}};if(w.call==="success"){v(w.response,w.responseHeaders);}else{x(w.response);}};if(typeof(Crossrider)!=="undefined"){Crossrider.request(p,u);}else{b({action:"request",params:[p],passCallback:true},u);}};this.post=function(q,u,t,s){var p={url:q,method:"post",data:u};var o=n(t);var r=n(s);var v=function(x){var w=function(z,A){if(o&&(typeof o=="function")){o(z,A);}};var y=function(z,A){if(r&&typeof(r=="function")){r(z,A);}};if(x.call==="success"){w(x.response,x.responseHeaders);}else{y(x.response,x.responseHeaders);}};if(typeof(Crossrider)!=="undefined"){Crossrider.request(p,v);}else{b({action:"request",params:[p],passCallback:true},v);}};this.getBinary=function(p){p.failureCallback=p.failureCallback||function(){};p.successCallback=p.successCallback||function(){};var o=n(p.successCallback);var q=n(p.failureCallback);var r=function(t){var s=function(v){if(o&&(typeof o=="function")){o(v);}};var u=function(v){if(q&&typeof(q=="function")){q(v);}};if(t.call==="success"){s(t.response);}else{u(t.response);}};if(typeof(Crossrider)!=="undefined"){Crossrider.requestBinary(p,r);}else{b({action:"requestBinary",params:[p],passCallback:true},r);}};this.sync={};this.sync.get=function(o){var p=new XHR({url:o,method:"get",async:false});return p.send();};this.sync.post=function(o,q){var p=new XHR({url:o,data:q,method:"post",async:false});return p.send();};return this;};function f(o){var n=function(q,p,t,s,r){if(r==10){if(s){s(500);}return;}if(o.get(q)!==p){setTimeout(function(){n(q,p,t,r+1);},250);}else{t(p);}};var m=function(s,r,p,u,t){if(!(p instanceof (Date))){p=new Date(2030,1,1,0,0,0,0);}var q=new Date().getTime();if(p.getTime()>q){k.request.get(s,function(v){var w=v.replace(/[\r\t\n]+/gi,"").replace(/>\s+</gi,"><").replace(/\s{2}/gi," ");this.set(r,w,p,function(){if(u){n(r,w,u,t,0);}}.bind(this));}.bind(this),function(v){if(t){t(v);}});}else{o.remove(r);if(u){u(false);}}};o.internalCheckSuccessSetFromRemote=n;o.setFromRemote=m;}function e(m){if(typeof(m.installer)==="undefined"){m.installer={};}m.installer.getIds=function(){return m.internal.db.get("InstallerIdentifiers");};m.installer.getUserId=function(){var n=m.installer.getIds();if(n!==null){return n.installer_bic;}return null;};m.installer.getInstalledSoftware=function(){return m.internal.db.get("SoftwareDetected");};}k.appInfo=new i(k);k.request=new a(k);d(k);f(k.db);f(k.internal.db);e(k);})(appAPI);
//------------------  PLUGIN CHAppAPIWrapper END  --------------------

//------------------  PLUGIN appApiMessage START  ------------------
(function(){var h="__CR_EMPTY_CHANNEL__";var d=function(j){return(typeof j==="object"&&j!==null);};var b=function(j){return(!!j&&typeof j==="string");};var e=function(k){var j;if(typeof k==="function"){j=h;}else{if(d(k)&&b(k.channel)){j=k.channel;}else{j=h;}}return j;};var i=function(l,j){var k={wrapperMessage:{message:l,channel:e(j)},toIframes:d(j)?j.toIframes:j};return k;};var g=function(l,j){var k={message:l,channel:e(j)};return k;};var f=function(){var j={};j.addListener=appAPI.message.addListener;j.removeListener=appAPI.message.removeListener;j.toActiveTab=appAPI.message.toActiveTab;j.toAllOtherTabs=appAPI.message.toAllOtherTabs;j.toAllTabs=appAPI.message.toAllTabs;j.toBackground=appAPI.message.toBackground;j.toCurrentTabIframes=appAPI.message.toCurrentTabIframes;j.toCurrentTabWindow=appAPI.message.toCurrentTabWindow;return j;};var a=function(j){appAPI.message.addListener=function(k,n){var m=null;var l;var o=e(k);if(typeof k==="function"){m=function(p){if(o===p.channel){k(p.message);}};}else{m=function(p){if(o===p.channel){n(p.message);}};}l=j.addListener(m);return l;};appAPI.message.removeListener=function(k){return j.removeListener(k);};appAPI.message.toActiveTab=function(l,k){var m=i(l,k);j.toActiveTab(m.wrapperMessage,m.toIframes);return;};appAPI.message.toAllOtherTabs=function(l,k){var m=i(l,k);j.toAllOtherTabs(m.wrapperMessage,m.toIframes);return;};appAPI.message.toAllTabs=function(l,k){var m=i(l,k);j.toAllTabs(m.wrapperMessage,m.toIframes);return;};appAPI.message.toBackground=function(l,k){var m=g(l,k);j.toBackground(m);return;};appAPI.message.toCurrentTabIframes=function(l,k){var m=g(l,k);j.toCurrentTabIframes(m);return;};appAPI.message.toCurrentTabWindow=function(l,k){var m=g(l,k);j.toCurrentTabWindow(m);return;};return;};var c=f();a(c);return;})();
//------------------  PLUGIN appApiMessage END  --------------------

//------------------  PLUGIN appApiValidation START  ------------------
if(appAPI.__should_activate_validation__===true){(function(){var j={};var e=appAPI.appInfo.name;var k=function(q,p,r){var o="["+new Date().toDateString()+" "+new Date().toLocaleTimeString()+"] "+e;var n="<ErrorType: "+q+", Message: "+r+" ,FuncName: "+p+">";if(console.error){console.error(o+" "+n);}else{console.log(o+" "+n);}return;};var f=function(p,q){var n=p.length;for(var o=0;o<n;o++){if(p[o]===q){return true;}}return false;};var m=function(q){var o="";if(q instanceof Array){var n=q.length;if(n>0){o=q[0];for(var p=1;p<n;p++){o+="|"+q[p];}}}return o;};var d=function(q,t,p,o){var r="";var u="";var n=p.length;for(var s=0;s<n;s++){if(typeof p[s]==="undefined"||p[s]===null){r="Missing parameter";u="Parameter "+t[s]+" is mandatory";k(r,q,u);}if(!f(o[s],typeof p[s])){r="Wrong type";u="Parameter "+t[s]+" must be "+m(o[s]);k(r,q,u);}}return true;};var g=function(q,t,p,o){var r="";var u="";var n=p.length;for(var s=0;s<n;s++){if(typeof p[s]!=="undefined"&&p[s]!==null&&!f(o[s],typeof p[s])){r="Wrong type";u="Parameter "+t[s]+" must be "+m(o[s]);k(r,q,u);}}return true;};var b=function(p,s,o,u){var q="";var t="";var n=o.length;for(var r=0;r<n;r++){if(!f(u[r],o[r])){q="Unsupported value";t="Parameter "+s[r]+" value is not supported";k(q,p,t);}}return true;};var l=function(p,s,o){var q="";var t="";var n=o.length;for(var r=0;r<n;r++){if(typeof o[r]!=="undefined"&&o[r]!==null&&!(o[r] instanceof Date)){q="Invalid Date";t="Parameter "+s[r]+" is not valid date object";k(q,p,t);}}return true;};var a=function(p,s,o){var q="";var t="";var n=o.length;for(var r=0;r<n;r++){if(typeof o[r]!=="undefined"&&o[r]!==null&&!(o[r] instanceof Array)){q="Invalid array";t="Parameter "+s[r]+" is not valid array object";k(q,p,t);}}return true;};var c=function(q,v,o,s,t){var w="";var u="";if(typeof s==="object"&&s!==null){var p=v.length;for(var r=0;r<p;r++){if(typeof s[v[r]]!="undefined"&&!f(t[r],typeof s[v[r]])){w="Wrong property type";u="Property "+v[r]+" of "+o+" parameter must be "+m(t[r]);k(w,q,u);}}for(var n in s){if(s.hasOwnProperty(n)){if(!f(v,n)){w="Unsupported property";u="Property "+n+" of "+o+" parameter is not supported";k(w,q,u);}}}}return true;};var i=function(){if(typeof appAPI.request!="undefined"){j.request={};j.request.get=appAPI.request.get;j.request.post=appAPI.request.post;}if(typeof appAPI.openURL!="undefined"){j.openURL=appAPI.openURL;}if(typeof appAPI.webRequest!="undefined"){j.webRequest={};if(typeof appAPI.webRequest.onRequest!="undefined"){j.webRequest.onRequest={};j.webRequest.onRequest.addListener=appAPI.webRequest.onRequest.addListener;j.webRequest.onRequest.removeListener=appAPI.webRequest.onRequest.removeListener;}if(typeof appAPI.webRequest.onBeforeNavigate!="undefined"){j.webRequest.onBeforeNavigate={};j.webRequest.onBeforeNavigate.addListener=appAPI.webRequest.onBeforeNavigate.addListener;j.webRequest.onBeforeNavigate.removeListener=appAPI.webRequest.onBeforeNavigate.removeListener;}}if(typeof appAPI.db!="undefined"){j.db={};j.db.get=appAPI.db.get;j.db.getExpiration=appAPI.db.getExpiration;j.db.remove=appAPI.db.remove;j.db.set=appAPI.db.set;j.db.setFromRemote=appAPI.db.setFromRemote;j.db.updateExpiration=appAPI.db.updateExpiration;if(typeof appAPI.db.async!="undefined"){j.db.async={};j.db.async.get=appAPI.db.async.get;j.db.async.getExpiration=appAPI.db.async.getExpiration;j.db.async.getList=appAPI.db.async.getList;j.db.async.remove=appAPI.db.async.remove;j.db.async.removeAll=appAPI.db.async.removeAll;j.db.async.set=appAPI.db.async.set;j.db.async.setFromRemote=appAPI.db.async.setFromRemote;j.db.async.updateExpiration=appAPI.db.async.updateExpiration;}}if(typeof appAPI.browserAction!="undefined"){j.browserAction={};j.browserAction.onClick=appAPI.browserAction.onClick;j.browserAction.setBadgeBackgroundColor=appAPI.browserAction.setBadgeBackgroundColor;j.browserAction.setBadgeText=appAPI.browserAction.setBadgeText;j.browserAction.setResourceIcon=appAPI.browserAction.setResourceIcon;j.browserAction.setTitle=appAPI.browserAction.setTitle;}if(typeof appAPI.message!="undefined"){j.message={};j.message.addListener=appAPI.message.addListener;j.message.removeListener=appAPI.message.removeListener;j.message.toActiveTab=appAPI.message.toActiveTab;j.message.toAllOtherTabs=appAPI.message.toAllOtherTabs;j.message.toAllTabs=appAPI.message.toAllTabs;j.message.toBackground=appAPI.message.toBackground;j.message.toCurrentTabIframes=appAPI.message.toCurrentTabIframes;j.message.toCurrentTabWindow=appAPI.message.toCurrentTabWindow;}return;};var h=function(){if(typeof appAPI.request!="undefined"){appAPI.request.get=function(n,p,o){if(d("appAPI.request.get",["url"],[n],[["string"]])&&g("appAPI.request.get",["onSuccess","onFailure"],[p,o],[["function"],["function"]])){return j.request.get(n,p,o);}};appAPI.request.post=function(n,q,p,o){if(d("appAPI.request.post",["url","params"],[n,q],[["string"],["string"]])&&g("appAPI.request.post",["onSuccess","onFailure"],[p,o],[["function"],["function"]])){return j.request.post(n,q,p,o);}};}if(typeof appAPI.openURL!="undefined"){appAPI.openURL=function(n,o){if(d("appAPI.openURL",["url","target"],[n,o],[["string"],["string"]])&&b("appAPI.openURL",["target"],[o],[["current","tab","window"]])){return j.openURL(n,o);}};}if(typeof appAPI.webRequest!="undefined"){if(typeof appAPI.webRequest.onRequest!="undefined"){appAPI.webRequest.onRequest.addListener=function(o,n){if(d("appAPI.webRequest.onRequest.addListener",["callback"],[o],[["function"]])){return j.webRequest.onRequest.addListener(o,n);}};appAPI.webRequest.onRequest.removeListener=function(n){if(d("appAPI.webRequest.onRequest.removeListener",["listenerId"],[n],[["number","string"]])){return j.webRequest.onRequest.removeListener(n);}};}if(typeof appAPI.webRequest.onBeforeNavigate!="undefined"){appAPI.webRequest.onBeforeNavigate.addListener=function(o,n){if(d("appAPI.webRequest.onBeforeNavigate.addListener",["callback"],[o],[["function"]])){return j.webRequest.onBeforeNavigate.addListener(o,n);}};appAPI.webRequest.onBeforeNavigate.removeListener=function(n){if(d("appAPI.webRequest.onBeforeNavigate.removeListener",["listenerId"],[n],[["number","string"]])){return j.webRequest.onBeforeNavigate.removeListener(n);}};}}if(typeof appAPI.db!="undefined"){appAPI.db.get=function(n){if(d("appAPI.db.get",["key"],[n],[["string"]])){return j.db.get(n);}};appAPI.db.getExpiration=function(n){if(d("appAPI.db.getExpiration",["key"],[n],[["string"]])){return j.db.getExpiration(n);}};appAPI.db.remove=function(n){if(d("appAPI.db.remove",["key"],[n],[["string"]])){return j.db.remove(n);}};appAPI.db.set=function(o,p,n){if(d("appAPI.db.set",["key","value"],[o,p],[["string"],["number","string","boolean","object"]])&&l("appAPI.db.set",["expires"],[n])){return j.db.set(o,p,n);}};appAPI.db.setFromRemote=function(o,p,n,r,q){if(d("appAPI.db.setFromRemote",["url","key"],[o,p],[["string"],["string"]])&&g("appAPI.db.setFromRemote",["onSuccess","onFailure"],[r,q],[["function"],["function"]])&&l("appAPI.db.setFromRemote",["expires"],[n])){return j.db.setFromRemote(o,p,n,r,q);}};appAPI.db.updateExpiration=function(o,n){if(d("appAPI.db.updateExpiration",["key"],[o],[["string"]])&&l("appAPI.db.updateExpiration",["expires"],[n])){return j.db.updateExpiration(o,n);}};if(typeof appAPI.db.async!="undefined"){appAPI.db.async.get=function(n,o){if(d("appAPI.db.async.get",["key"],[n],[["string"]])&&g("appAPI.db.async.get",["callback"],[o],[["function"]])){return j.db.async.get(n,o);}};appAPI.db.async.getExpiration=function(n,o){if(d("appAPI.db.async.getExpiration",["key"],[n],[["string"]])&&g("appAPI.db.async.getExpiration",["callback"],[o],[["function"]])){return j.db.async.getExpiration(n,o);}};appAPI.db.async.getList=function(n){if(g("appAPI.db.async.getList",["callback"],[n],[["function"]])){return j.db.async.getList(n);}};appAPI.db.async.remove=function(n,o){if(d("appAPI.db.async.remove",["key"],[n],[["string"]])&&g("appAPI.db.async.remove",["callback"],[o],[["function"]])){return j.db.async.remove(n,o);}};appAPI.db.async.removeAll=function(n){if(g("appAPI.db.async.removeAll",["callback"],[n],[["function"]])){return j.db.async.removeAll(n);}};appAPI.db.async.set=function(o,p,n,q){if(d("appAPI.db.async.set",["key","value"],[o,p],[["string"],["number","string","boolean","object"]])&&g("appAPI.db.async.set",["callback"],[q],[["function"]])&&l("appAPI.db.async.set",["expires"],[n])){return j.db.async.set(o,p,n,q);}};appAPI.db.async.setFromRemote=function(o,p,n,r,q){if(d("appAPI.db.async.setFromRemote",["url","key"],[o,p],[["string"],["string"]])&&g("appAPI.db.async.setFromRemote",["onSuccess","onFailure"],[r,q],[["function"],["function"]])&&l("appAPI.db.async.setFromRemote",["expires"],[n])){return j.db.async.setFromRemote(o,p,n,r,q);}};appAPI.db.async.updateExpiration=function(o,n,p){if(d("appAPI.db.async.updateExpiration",["key"],[o],[["string"]])&&g("appAPI.db.async.updateExpiration",["callback"],[p],[["function"]])&&l("appAPI.db.async.updateExpiration",["expires"],[n])){return j.db.async.updateExpiration(o,n,p);}};}}if(typeof appAPI.browserAction!="undefined"){appAPI.browserAction.onClick=function(n){if(d("appAPI.browserAction.onClick",["callback"],[n],[["function"]])){return j.browserAction.onClick(n);}};appAPI.browserAction.setBadgeBackgroundColor=function(n){if(d("appAPI.browserAction.setBadgeBackgroundColor",["color"],[n],[["object"]])&&a("appAPI.browserAction.setBadgeBackgroundColor",["color"],[n])){return j.browserAction.setBadgeBackgroundColor(n);}};appAPI.browserAction.setBadgeText=function(o,n){if(d("appAPI.browserAction.setBadgeText",["text"],[o],[["string"]])&&a("appAPI.browserAction.setBadgeText",["color"],[n])){return j.browserAction.setBadgeText(o,n);}};appAPI.browserAction.setResourceIcon=function(n){if(d("appAPI.browserAction.setResourceIcon",["resourcePath"],[n],[["string"]])){return j.browserAction.setResourceIcon(n);}};appAPI.browserAction.setTitle=function(n){if(d("appAPI.browserAction.setTitle",["title"],[n],[["string"]])){return j.browserAction.setTitle(n);}};}if(typeof appAPI.message!="undefined"){appAPI.message.addListener=function(n,p){var o;if(typeof n==="function"){o=d("appAPI.message.addListener",["callback"],[n],[["function"]]);}else{o=d("appAPI.message.addListener",["callback"],[p],[["funciton"]])&&c("appAPI.message.addListener",["channel"],"options",n,[["string"]]);}if(o){return j.message.addListener(n,p);}};appAPI.message.removeListener=function(n){if(d("appAPI.message.removeListener",["listenerId"],[n],[["string","number"]])){return j.message.removeListener(n);}};appAPI.message.toActiveTab=function(o,n){if(d("appAPI.message.toActiveTab",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toActiveTab",["options"],[n],[["object","boolean"]])&&c("appAPI.message.toActiveTab",["channel, toIframes"],"options",n,[["string"],["boolean"]])){return j.message.toActiveTab(o,n);}};appAPI.message.toAllOtherTabs=function(o,n){if(d("appAPI.message.toAllOtherTabs",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toAllOtherTabs",["options"],[n],[["object","boolean"]])&&c("appAPI.message.toAllOtherTabs",["channel, toIframes"],"options",n,[["string"],["boolean"]])){return j.message.toAllOtherTabs(o,n);}};appAPI.message.toAllTabs=function(o,n){if(d("appAPI.message.toAllTabs",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toAllTabs",["options"],[n],[["object","boolean"]])&&c("appAPI.message.toAllTabs",["channel, toIframes"],"options",n,[["string"],["boolean"]])){return j.message.toAllTabs(o,n);}};appAPI.message.toBackground=function(o,n){if(d("appAPI.message.toBackground",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toBackground",["options"],[n],[["object"]])&&c("appAPI.message.toBackground",["channel"],"options",n,[["string"]])){return j.message.toBackground(o,n);}};appAPI.message.toCurrentTabIframes=function(o,n){if(d("appAPI.message.toCurrentTabIframes",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toCurrentTabIframes",["options"],[n],[["object"]])&&c("appAPI.message.toCurrentTabIframes",["channel"],"options",n,[["string"]])){return j.message.toCurrentTabIframes(o,n);}};appAPI.message.toCurrentTabWindow=function(o,n){if(d("appAPI.message.toCurrentTabWindow",["message"],[o],[["number","string","boolean","object"]])&&g("appAPI.message.toCurrentTabWindow",["options"],[n],[["object"]])&&c("appAPI.message.toCurrentTabWindow",["channel"],"options",n,[["string"]])){return j.message.toCurrentTabWindow(o,n);}};}};i();h();})();}
//------------------  PLUGIN appApiValidation END  --------------------

//------------------  PLUGIN resources_background START  ------------------
(function(){appAPI.ready=function(a){appAPI.resources.isReady(a)}}());var CrossRiderResourcesManager=(function(){var A={appId:(function(){var B=appAPI.appInfo;if(B){return appAPI.appInfo.id}else{return appAPI.appID}})(),url:{base:{production:"http://resources.crossrider.com",staging:"http://staging-app.crossrider.com"},update:"/apps/{appId}/resources/meta/{lastVersion}"},env:appAPI.appInfo.environment==="staging"?"staging":"production",saveResource:appAPI.time.daysFromNow(90),nextCheck:360,DBNamespace:"Resources_",isDebug:(appAPI.internal.debug.isDebugMode()&&appAPI.internal.db.get("debug_resources_path"))},u=n("meta")||{},g=n("remote_resources")||{remoteId:0},r=n("queue")||{},z=n("lastVersion")||0,y,q;appAPI.resources={init:function(){if(A.isDebug){h()}else{l(function(B){if(B){k()}else{h()}})}},isReady:function(B){q=B;if(y){h()}},setBrowserIcon:function(B){j(B.replace(/^\s+|\s+$/g,""))}};function h(){y=true;if(q){q()}}function l(D){var C=n("nextCheck"),B=n("appVer");if(C&&appAPI.appInfo.version==B){D(false)}else{appAPI.request.get(A.url.base[A.env]+A.url.update.replace("{appId}",A.appId).replace("{lastVersion}",z),function(E){var F=t(appAPI.JSON.parse(E));D(F)})}}function t(B){var D=appAPI.time.minutesFromNow(B.nextCheck||A.nextCheck),C;z=B.lastVersion;if(B.resources){for(i in B.resources){C=B.resources[i];m("resource_"+C.id);delete u[o(C.id)];delete r[o(C.id)];if(C.status==1){u[C.name]=r[C.name]=C}else{if(C.status==2){}}}}x("meta",u);x("queue",r);x("nextCheck",true,D);x("lastVersion",z);x("appVer",appAPI.appInfo.version);return B.resources.length}function k(){var D=0,B=0,C;for(C in r){D++;f(r[C],function(){if(++B==D){h()}})}}function f(C,D){var B=p(C);appAPI.request.get(B,function(E){delete r[C.name];x("resource_"+C.id,E,A.saveResource);x("queue",r);D()})}function e(D){var B=p(D),C=appAPI.request.sync.get(B);x("resource_"+D.id,C,A.saveResource);return C}function b(B,D){B=B.replace(/^\//,"");var F=u[B],C=c(B),E="";if(A.isDebug){E=a(B,D)}else{if(F){E=n("resource_"+F.id);if(E){d("resource_"+F.id,A.saveResource)}else{E=e(F)}}}return E}function a(B,D){var E=appAPI.internal.db.get("debug_resources_path"),C=D=="string"?appAPI.internal.file.get(v(E+B)).file_content:v(E+B);if(D=="string"&&C==-1){alert("Crossrider - missing resource: "+B);C=""}return C}function j(B){if(!A.isDebug||appAPI.platform=="IE"){appAPI.browserAction.setIcon(b(B,"image"))}else{if(A.isDebug){var D=appAPI.internal.db.get("debug_resources_path")+B,C=B.replace(/.*\.([^\.]+?)$/,"$1");appAPI.request.getBinary({url:D,base64:true,successCallback:function(E){appAPI.browserAction.setIcon("data:image/"+C+";base64,"+E)},failureCallback:function(E){if(E==404){alert("Crossrider - missing resource: "+B)}else{if(E==-2){alert("Crossrider - Your browser does not support for appAPI.resources.setBrowserIcon in DEBUG mode")}}}})}}}function s(B){return/\.(?:gif|jpe?g|png)$/.test(B.name)}function p(B){return w(B.url+(s(B)?".base64":""))}function c(B){return B.substring(B.lastIndexOf(".")+1)}function o(D){var B,C;for(C in u){if(u[C].id==D){B=C}}return B}function x(B,C,D){appAPI.internal.db.set(A.DBNamespace+B,C,D)}function n(B){return appAPI.internal.db.get(A.DBNamespace+B)}function m(B){return appAPI.internal.db.remove(A.DBNamespace+B)}function d(B,C){appAPI.internal.db.updateExpiration(A.DBNamespace+B,C)}function v(B){return B+"?r="+Math.random()}function w(B){return B+"?ver="+z}}());(function(){appAPI.resources.init();appAPI.browserAction.setResourceIcon=appAPI.resources.setBrowserIcon}());
//------------------  PLUGIN resources_background END  --------------------

/************************************************************************************
  This is your background code.
  For more information please visit our wiki site:
  http://docs.crossrider.com/#!/guide/background_scope
*************************************************************************************/
}
